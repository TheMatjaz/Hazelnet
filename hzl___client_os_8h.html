<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hazelnet: inc/hzl_ClientOs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Hazelnet<span id="projectnumber">&#160;3.0.0</span>
   </div>
   <div id="projectbrief">Reference implementation of the CAN Bus Security (CBS) protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">hzl_ClientOs.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Hazelnet Client public API, addon for Operating Systems.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="hzl_8h_source.html">hzl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hzl___client_8h_source.html">hzl_Client.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for hzl_ClientOs.h:</div>
<div class="dyncontent">
<div class="center"><img src="hzl___client_os_8h__incl.png" border="0" usemap="#ainc_2hzl___client_os_8h" alt=""/></div>
<map name="ainc_2hzl___client_os_8h" id="ainc_2hzl___client_os_8h">
<area shape="rect" title="Hazelnet Client public API, addon for Operating Systems." alt="" coords="356,5,485,32"/>
<area shape="rect" href="hzl_8h.html" title="General public definitions used used by both the Hazelnet Server and Client." alt="" coords="395,155,446,181"/>
<area shape="rect" href="hzl___client_8h.html" title="Hazelnet Client public API." alt="" coords="417,80,507,107"/>
<area shape="rect" title=" " alt="" coords="5,229,71,256"/>
<area shape="rect" title=" " alt="" coords="95,229,170,256"/>
<area shape="rect" title=" " alt="" coords="194,229,263,256"/>
<area shape="rect" title=" " alt="" coords="288,229,353,256"/>
<area shape="rect" title=" " alt="" coords="377,229,464,256"/>
<area shape="rect" title=" " alt="" coords="488,229,580,256"/>
<area shape="rect" title=" " alt="" coords="605,229,674,256"/>
<area shape="rect" title=" " alt="" coords="698,229,759,256"/>
<area shape="rect" title=" " alt="" coords="783,229,847,256"/>
</map>
</div>
</div>
<p><a href="hzl___client_os_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abf71451df25f2969929ce4dfe13b5040"><td class="memItemLeft" align="right" valign="top"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> <a class="el" href="hzl_8h.html#a992c5466a30f9bf40204cfc5bd8a8bec">hzl_Err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hzl___client_os_8h.html#abf71451df25f2969929ce4dfe13b5040">hzl_ClientNew</a> (<a class="el" href="hzl___client_8h.html#a4c8aa1f4d3fc36d271b83197b68cae47">hzl_ClientCtx_t</a> **pCtx, const char *fileName)</td></tr>
<tr class="memdesc:abf71451df25f2969929ce4dfe13b5040"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a new context structure on the heap and fills it with the new configuration from the file and OS functions for time and randomness.  <a href="hzl___client_os_8h.html#abf71451df25f2969929ce4dfe13b5040">More...</a><br /></td></tr>
<tr class="separator:abf71451df25f2969929ce4dfe13b5040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2be037a6fd82c7145363e4d358395b0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hzl___client_os_8h.html#ae2be037a6fd82c7145363e4d358395b0">hzl_ClientFree</a> (<a class="el" href="hzl___client_8h.html#a4c8aa1f4d3fc36d271b83197b68cae47">hzl_ClientCtx_t</a> **pCtx)</td></tr>
<tr class="memdesc:ae2be037a6fd82c7145363e4d358395b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Zeros-out the context, frees it and sets the pointer to it to NULL, to avoid use-after-free and double-free.  <a href="hzl___client_os_8h.html#ae2be037a6fd82c7145363e4d358395b0">More...</a><br /></td></tr>
<tr class="separator:ae2be037a6fd82c7145363e4d358395b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9de5315b1b4d65979c53b3cc8de55beb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> <a class="el" href="hzl_8h.html#a992c5466a30f9bf40204cfc5bd8a8bec">hzl_Err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hzl___client_os_8h.html#a9de5315b1b4d65979c53b3cc8de55beb">hzl_ClientNewMsg</a> (<a class="el" href="hzl_8h.html#a6e136aa15a3fa6d1ae6ade363b0b518c">hzl_CbsPduMsg_t</a> **pMsg)</td></tr>
<tr class="memdesc:a9de5315b1b4d65979c53b3cc8de55beb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a new CAN FD message structure on the heap with enough space to hold up to 64 B of data.  <a href="hzl___client_os_8h.html#a9de5315b1b4d65979c53b3cc8de55beb">More...</a><br /></td></tr>
<tr class="separator:a9de5315b1b4d65979c53b3cc8de55beb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeda12133ba9859df8000e3bae51c5db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hzl___client_os_8h.html#abeda12133ba9859df8000e3bae51c5db">hzl_ClientFreeMsg</a> (<a class="el" href="hzl_8h.html#a6e136aa15a3fa6d1ae6ade363b0b518c">hzl_CbsPduMsg_t</a> **pMsg)</td></tr>
<tr class="memdesc:abeda12133ba9859df8000e3bae51c5db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Zeros-out the message, frees it and sets the pointer to it to NULL, to avoid use-after-free and double-free.  <a href="hzl___client_os_8h.html#abeda12133ba9859df8000e3bae51c5db">More...</a><br /></td></tr>
<tr class="separator:abeda12133ba9859df8000e3bae51c5db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Hazelnet Client public API, addon for Operating Systems. </p>
<p >Hazelnet implements the CAN Bus Security (CBS) protocol, which secures the CAN FD traffic providing encryption, authenticity and freshness of the messages.</p>
<p >This header adds to the <a class="el" href="hzl___client_8h.html" title="Hazelnet Client public API.">hzl_Client.h</a> header, providing a simpler alternative for desktop usage on an OS like Windows or Linux compared to an embedded usage. This API allows the user to heap-allocate the Client context, load its configuration from file and assign the timestamping and TRNG functions automatically by using the ones provided by the OS. Similarly, heap-allocation of messages is also available. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="abf71451df25f2969929ce4dfe13b5040" name="abf71451df25f2969929ce4dfe13b5040"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf71451df25f2969929ce4dfe13b5040">&#9670;&nbsp;</a></span>hzl_ClientNew()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> <a class="el" href="hzl_8h.html#a992c5466a30f9bf40204cfc5bd8a8bec">hzl_Err_t</a> hzl_ClientNew </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hzl___client_8h.html#a4c8aa1f4d3fc36d271b83197b68cae47">hzl_ClientCtx_t</a> **&#160;</td>
          <td class="paramname"><em>pCtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fileName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new context structure on the heap and fills it with the new configuration from the file and OS functions for time and randomness. </p>
<p >This is a handy replacement of <a class="el" href="hzl___client_8h.html#a8871f5c25863990dd7103848732338b0" title="Initialisation of the Client.">hzl_ClientInit()</a> to use when on an OS to simplify the library usage. The function would automatically allocate the context and fill its configuration fields from the file. The IO functions for TRNG and timestamping are also obtained from the OS. The user must only supply the low level transmission function and the file name where to take the configuration from.</p>
<p >It's up to the user to free the context allocated by this function using <a class="el" href="hzl___client_os_8h.html#ae2be037a6fd82c7145363e4d358395b0" title="Zeros-out the context, frees it and sets the pointer to it to NULL, to avoid use-after-free and doubl...">hzl_ClientFree()</a>.</p>
<h3><a class="anchor" id="autotoc_md0"></a>
File format</h3>
<p >The file must have the following format with all multi-byte integers encoded as little Endian and without any paddings between any value or between any struct:</p>
<ol type="1">
<li>"HZL\0" as a magic number in ASCII encoding, used to double-check that the loaded file is the correct one. That is: [0x48, 0x5A, 0x4C, 0x00] in binary;</li>
<li>the whole <a class="el" href="hzl___client_8h.html#a362852671be83477c9e64e5485b5b778" title="Hazelnet Client constant configuration.">hzl_ClientConfig_t</a> struct without any padding;</li>
<li>an array of <a class="el" href="hzl___client_8h.html#a97e46eb33083139af1a9bdfbc801edbf" title="Hazelnet Client constant Group configuration.">hzl_ClientGroupConfig_t</a> structs without any padding and with as many elements (structs) as specified in <a class="el" href="structhzl___client_config.html#a37f00daaa985ac13b929287b5b224bc7" title="Only Groups this client is in, i.e.">hzl_ClientConfig_t.amountOfGroups</a>.</li>
</ol>
<p >It's common to use the <code>.hzl</code> file extension to denote this file format. To generate such binary file from a JSON file, the helper Python scripts in <code>toolsupport/config</code> can be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pCtx</td><td>where to load the new context. Must not be NULL. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fileName</td><td>path to the file to load the configuration from. Must not be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da987be958f061493a9aa216995fd2556b" title="Successful completion of the operation.">HZL_OK</a></td><td>on success. </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da516d0e8c3428c167f49e0c13b18aded9" title="The function requires a pointer to the Hazelnet context, but NULL was provided.">HZL_ERR_NULL_CTX</a></td><td>if <code>pCtx</code> is NULL. </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11dabe6431cabcafb6f07579e9ac802e53c8" title="The configuration file name string is NULL.">HZL_ERR_NULL_FILENAME</a></td><td>if <code>fileName</code> is NULL. </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11dae6854a90e37d0f492ca8fe072a73b877" title="The configuration file could not be opened.">HZL_ERR_CANNOT_OPEN_CONFIG_FILE</a></td><td>if the file cannot be opened (does not exists, or the permissions are not correct) </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da03dcc5566e93f284eb4d5c25d46e634d" title="Heap-memory allocation failure: out of memory.">HZL_ERR_MALLOC_FAILED</a></td><td>if the heap-allocation fails (out of memory). </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da457c0059966e8378335c55d79fe39eef" title="The configuration file was shorter than expected, some parts of the configuration are left out.">HZL_ERR_UNEXPECTED_EOF</a></td><td>if the file is too short: more data was expected during parsing. Probably is has incorrect syntax or amount of groups. </td></tr>
    <tr><td class="paramname">Same</td><td>values as <a class="el" href="hzl___client_8h.html#a8871f5c25863990dd7103848732338b0" title="Initialisation of the Client.">hzl_ClientInit()</a> in case the context has incorrect data or pointers. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae2be037a6fd82c7145363e4d358395b0" name="ae2be037a6fd82c7145363e4d358395b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2be037a6fd82c7145363e4d358395b0">&#9670;&nbsp;</a></span>hzl_ClientFree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> void hzl_ClientFree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hzl___client_8h.html#a4c8aa1f4d3fc36d271b83197b68cae47">hzl_ClientCtx_t</a> **&#160;</td>
          <td class="paramname"><em>pCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Zeros-out the context, frees it and sets the pointer to it to NULL, to avoid use-after-free and double-free. </p>
<p >If some fields are partially-initialised, it clears and frees anything not-NULL.</p>
<dl class="section warning"><dt>Warning</dt><dd>Only use on heap-allocated contexts, as created by <a class="el" href="hzl___client_os_8h.html#abf71451df25f2969929ce4dfe13b5040" title="Allocates a new context structure on the heap and fills it with the new configuration from the file a...">hzl_ClientNew()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pCtx</td><td>address of the pointer to the context. The address of it is used to set the pointer to NULL after the data has been freed. If NULL or if <code>*pCtx</code> is NULL, the function does nothing. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9de5315b1b4d65979c53b3cc8de55beb" name="a9de5315b1b4d65979c53b3cc8de55beb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9de5315b1b4d65979c53b3cc8de55beb">&#9670;&nbsp;</a></span>hzl_ClientNewMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> <a class="el" href="hzl_8h.html#a992c5466a30f9bf40204cfc5bd8a8bec">hzl_Err_t</a> hzl_ClientNewMsg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hzl_8h.html#a6e136aa15a3fa6d1ae6ade363b0b518c">hzl_CbsPduMsg_t</a> **&#160;</td>
          <td class="paramname"><em>pMsg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new CAN FD message structure on the heap with enough space to hold up to 64 B of data. </p>
<p >It's up to the user to free the message allocated by this function using <a class="el" href="hzl___client_os_8h.html#abeda12133ba9859df8000e3bae51c5db" title="Zeros-out the message, frees it and sets the pointer to it to NULL, to avoid use-after-free and doubl...">hzl_ClientFreeMsg()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pMsg</td><td>where to load the new message. Must not be NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da987be958f061493a9aa216995fd2556b" title="Successful completion of the operation.">HZL_OK</a></td><td>on success. </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da9cc853977b60a5049a33c774f8656c1a" title="The pointer to the Protocol Data Unit (packed CBS message) to transmit or the just-received one is NU...">HZL_ERR_NULL_PDU</a></td><td>if pMsg is NULL. </td></tr>
    <tr><td class="paramname"><a class="el" href="hzl_8h.html#a9e46f00210350b247e5ec159e29ec11da03dcc5566e93f284eb4d5c25d46e634d" title="Heap-memory allocation failure: out of memory.">HZL_ERR_MALLOC_FAILED</a></td><td>if the heap-allocation fails (out of memory). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abeda12133ba9859df8000e3bae51c5db" name="abeda12133ba9859df8000e3bae51c5db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abeda12133ba9859df8000e3bae51c5db">&#9670;&nbsp;</a></span>hzl_ClientFreeMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hzl_8h.html#a625a0679f289e7ca5c747a78e5101b87">HZL_API</a> void hzl_ClientFreeMsg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hzl_8h.html#a6e136aa15a3fa6d1ae6ade363b0b518c">hzl_CbsPduMsg_t</a> **&#160;</td>
          <td class="paramname"><em>pMsg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Zeros-out the message, frees it and sets the pointer to it to NULL, to avoid use-after-free and double-free. </p>
<p >If some fields are partially-initialised, it clears and frees anything not-NULL.</p>
<dl class="section warning"><dt>Warning</dt><dd>Only use on heap-allocated messages, as created by <a class="el" href="hzl___client_os_8h.html#a9de5315b1b4d65979c53b3cc8de55beb" title="Allocates a new CAN FD message structure on the heap with enough space to hold up to 64 B of data.">hzl_ClientNewMsg()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pMsg</td><td>address of the pointer to the message. The address of it is used to set the pointer to NULL after the data has been freed. If NULL or if <code>*pMsg</code> is NULL, the function does nothing. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
